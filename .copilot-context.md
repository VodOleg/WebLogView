# Copilot Context - WebLogView Project

**Last Updated:** December 5, 2025

## Project Overview
WebLogView is a cross-platform, web-based log viewer with real-time file monitoring. It's designed as a self-hosted alternative to BareTail that works on Windows, macOS, and Linux.

## Tech Stack
- **Backend:** Go 1.21+
  - gorilla/websocket for WebSocket communication
  - fsnotify for file system monitoring
- **Frontend:** Preact (with virtual scrolling)
- **Communication:** WebSocket for real-time updates + HTTP REST API for settings

## Project Structure
```
WebLogView/
├── cmd/
│   └── main.go             # Application entry point
├── internal/
│   ├── config/             # Application configuration
│   │   └── config.go
│   ├── server/             # HTTP server and API endpoints
│   │   └── server.go
│   ├── settings/           # Persistent settings manager
│   │   └── settings.go
│   ├── watcher/            # File system monitoring (fsnotify)
│   │   └── watcher.go
│   └── websocket/          # WebSocket hub and client management
│       ├── client.go
│       └── hub.go
├── web/                    # Frontend Preact application
│   ├── src/
│   │   ├── components/
│   │   │   ├── App.jsx             # Main app with tab management
│   │   │   ├── LogViewerTab.jsx    # Individual tab component
│   │   │   ├── LogViewer.jsx       # Virtual scrolling log display
│   │   │   ├── ControlBar.jsx      # Filters and controls
│   │   │   ├── DropZone.jsx        # File path input
│   │   │   ├── ResizablePanes.jsx  # Dual-pane layout
│   │   │   └── SettingsModal.jsx   # Settings popup
│   │   ├── hooks/
│   │   │   └── useWebSocket.js     # WebSocket connection hook
│   │   └── main.jsx
│   ├── vite.config.js
│   └── package.json
├── DESIGN.md               # Detailed architecture documentation
├── README.md               # Quick start guide
├── go.mod                  # Go module dependencies
└── Makefile               # Build automation
```

## Key Features
- Real-time log file monitoring with fsnotify
- WebSocket-based log streaming
- Virtual scrolling for large files (react-window)
- Regex filtering (include/exclude patterns)
- Tabbed interface (Chrome-like multi-file support)
- Dual-pane layout (all lines + filtered lines)
- Resizable panes with draggable divider
- Horizontal scrolling for long log lines
- **ANSI color rendering** - Terminal colors displayed properly (using ansi-to-html)
- **Persistent settings** stored in `~/.weblogview/settings.json`
- Configurable initial window size (tail lines)
- Configurable ANSI rendering per pane (prettify or show raw)
- Cross-platform settings storage (Windows/macOS/Linux)

## Settings System
- **Backend:** `/internal/settings/settings.go`
  - Singleton pattern with thread-safe operations
  - Persists to `~/.weblogview/settings.json`
  - Cross-platform compatible (uses `os.UserHomeDir()` and `filepath.Join()`)
- **API Endpoint:** `/api/settings`
  - `GET` - Returns current settings
  - `POST` - Updates and saves settings
- **Frontend:** Settings modal (⚙️ button in control bar)
  - Initial Window Size: 100-100,000 lines (default: 1000)
  - ANSI Rendering for Top Pane: on/off (default: on - prettified)
  - ANSI Rendering for Bottom Pane: on/off (default: on - prettified)
  - Settings saved on backend and persist across restarts
- **ANSI Rendering:** Uses `ansi-to-html` library to convert terminal color codes to HTML
  - Configurable per pane (top/bottom)
  - When enabled: Shows colored logs like in terminal
  - When disabled: Shows raw ANSI escape codes

## Default Configuration
- Port: 8080
- Host: localhost
- Auto-browser: enabled
- Initial tail lines: 1000 (configurable via settings)
- Max line buffer: 10MB
- ANSI rendering: enabled for both panes (configurable via settings)

## Recent Changes
- **Dec 5, 2025:** Updated frontend stack from Vanilla JS to Preact in DESIGN.md
- **Dec 5, 2025:** Created main entry point at `cmd/main.go`
- **Dec 5, 2025:** Set up complete Preact frontend with Vite build system in `web/` directory
  - Created components: App, LogViewer, ControlBar, DropZone, ResizablePanes
  - Implemented WebSocket hook with auto-reconnect
  - Added virtual scrolling with react-window
  - Configured Vite with proxy to Go backend (127.0.0.1 for IPv4)
- **Dec 5, 2025:** Implemented tabbed interface for multiple log files
  - Chrome-like tabs with add/close functionality
  - Each tab is independent with its own state
  - Tab titles automatically update to filename
  - Refined tab UI (40% smaller, softer corners)
- **Dec 5, 2025:** Backend WebSocket implementation
  - Fixed message types (initial/lines) to match frontend
  - Increased buffer size to 10MB for long log lines
  - File watcher successfully reading and streaming logs
  - Fixed message batching issue (separate WebSocket frames)
- **Dec 5, 2025:** UI improvements
  - Added resizable panes with draggable divider
  - Implemented horizontal scrolling for long log lines
  - Fixed areas to maintain size when loading files (overflow:hidden, flexShrink:0)
  - Used ResizeObserver for proper container sizing
- **Dec 5, 2025:** Settings system implementation
  - Created `/internal/settings/settings.go` with persistent storage
  - Added `/api/settings` REST endpoint (GET/POST)
  - Built SettingsModal component with configurable window size
  - Settings persist to `~/.weblogview/settings.json`
  - Frontend now omits `tail` parameter to use backend settings value
- **Dec 5, 2025:** ANSI color rendering implementation
  - Installed `ansi-to-html` npm package
  - Added ANSI rendering settings (per pane) to backend and frontend
  - LogViewer component now renders ANSI escape codes as HTML colors
  - Configurable via settings modal (both panes default to prettified)
  - Terminal colors now display properly in log viewer

## Current Status
- ✅ Go backend server running on localhost:8080
- ✅ Vite dev server running on localhost:3000 with proxy to backend
- ✅ WebSocket connection established and stable
- ✅ Log files loading and displaying with configurable tail lines
- ✅ Virtual scrolling working with react-window
- ✅ Tabbed interface with add/close/switch functionality
- ✅ Dual-pane layout (all lines + filtered lines)
- ✅ Resizable panes with draggable divider
- ✅ Horizontal scrolling for long lines
- ✅ Include/exclude regex filters
- ✅ Auto-scroll toggle
- ✅ Settings system with persistent storage
- ✅ Real-time file watching (new lines streaming via WebSocket)
- ✅ ANSI color rendering (terminal colors displayed properly)

## Next Steps / TODOs
- Build production bundle and embed in Go binary
- Add file browser/selector for easier file selection
- Add syntax highlighting for log files (optional)
- Test on Windows and Linux
- Handle log file rotation
- Add "clear" button to reset log view
- Persist tab state (remember open files)
- Add more settings (theme, font size, etc.)

## Development Commands
```bash
# Install dependencies
go mod download

# Run in development
go run ./cmd

# Build
go build -o weblogview ./cmd

# Run with options
./weblogview -port 8080 -host localhost -no-browser
```

## Notes
- Project is in development phase
- Currently working on macOS environment
